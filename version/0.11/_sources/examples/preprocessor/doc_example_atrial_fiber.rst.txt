
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples\preprocessor\doc_example_atrial_fiber.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_preprocessor_doc_example_atrial_fiber.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_preprocessor_doc_example_atrial_fiber.py:


Atrial fiber
------------
This examples shows how to generate fibers with the Laplace-Dirichlet-Rule-Based-Method.

.. GENERATED FROM PYTHON SOURCE LINES 30-34

Perform the required imports
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Import the required modules and set relevant paths, including that of the working
directory, model, and ls-dyna executable (uses DEV-104373-g6d20c20aee).

.. GENERATED FROM PYTHON SOURCE LINES 34-58

.. code-block:: Python



    import os
    from pathlib import Path

    import numpy as np
    import pyvista as pv

    import ansys.heart.core.models as models
    from ansys.heart.core.simulator import BaseSimulator, DynaSettings

    # specify the path to the working directory and heart model. The following path assumes
    # that a preprocessed model is already available
    workdir = Path.home() / "pyansys-heart" / "downloads" / "Strocchi2020" / "01" / "FourChamber"
    path_to_model = str(workdir / "heart_model.vtu")

    # specify LS-DYNA path
    lsdyna_path = r"ls-dyna_smp"

    # load heart model.
    model: models.FourChamber = models.FourChamber(working_directory=workdir)
    model.load_model_from_mesh(path_to_model, path_to_model.replace(".vtu", ".partinfo.json"))



.. GENERATED FROM PYTHON SOURCE LINES 63-66

Instantiate the simulator object
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
instantiate simulator. Change options where necessary.

.. GENERATED FROM PYTHON SOURCE LINES 68-72

.. note::
   The DynaSettings object supports several LS-DYNA versions and platforms.
   Including: "smp", "intempi", "msmpi", "windows", "linux", or "wsl" Choose
   the one that is appropriate for you.

.. GENERATED FROM PYTHON SOURCE LINES 72-90

.. code-block:: Python


    # instantiate LS-DYNA settings of choice
    dyna_settings = DynaSettings(
        lsdyna_path=lsdyna_path, dynatype="intelmpi", num_cpus=4, platform="windows"
    )

    simulator = BaseSimulator(
        model=model,
        dyna_settings=dyna_settings,
        simulation_directory=os.path.join(workdir, "simulation"),
    )

    simulator.settings.load_defaults()

    # remove fiber/sheet information if already exists
    model.mesh.cell_data["fiber"] = np.zeros((model.mesh.n_cells, 3))
    model.mesh.cell_data["sheet"] = np.zeros((model.mesh.n_cells, 3))


.. GENERATED FROM PYTHON SOURCE LINES 91-93

Compute atrial fibers
~~~~~~~~~~~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 93-101

.. code-block:: Python


    # Compute left atrium fiber
    la = simulator.compute_left_atrial_fiber()

    # Appendage apex point should be manually given to compute right atrium fiber
    appendage_apex = [-33, 82, 417]
    ra = simulator.compute_right_atrial_fiber(appendage_apex)


.. GENERATED FROM PYTHON SOURCE LINES 102-105

.. note::
   You may need to define an appropriate point for the right atrial appendage
   the list defines the x, y, and z coordinates close to the appendage.

.. GENERATED FROM PYTHON SOURCE LINES 107-109

Plot bundle selection results
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 109-112

.. code-block:: Python

    la.set_active_scalars("bundle")
    la.plot()


.. GENERATED FROM PYTHON SOURCE LINES 113-116

.. image:: /_static/images/la_bundle.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 116-120

.. code-block:: Python


    ra.set_active_scalars("bundle")
    ra.plot()


.. GENERATED FROM PYTHON SOURCE LINES 121-124

.. image:: /_static/images/ra_bundle.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 126-128

Plot fibers
~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 128-136

.. code-block:: Python

    plotter = pv.Plotter()
    mesh = la.ctp()
    streamlines = mesh.streamlines(vectors="e_l", source_radius=50, n_points=50000)
    tubes = streamlines.tube()
    plotter.add_mesh(mesh, opacity=0.5, color="white")
    plotter.add_mesh(tubes, color="red")
    plotter.show()


.. GENERATED FROM PYTHON SOURCE LINES 137-140

.. image:: /_static/images/la_fiber.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 140-149

.. code-block:: Python


    plotter = pv.Plotter()
    mesh = ra.ctp()
    streamlines = mesh.streamlines(vectors="e_l", source_radius=50, n_points=50000)
    tubes = streamlines.tube()
    plotter.add_mesh(mesh, opacity=0.5, color="white")
    plotter.add_mesh(tubes, color="red")
    plotter.show()


.. GENERATED FROM PYTHON SOURCE LINES 150-153

.. image:: /_static/images/ra_fiber.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 155-166

.. code-block:: Python


    # Atrial fibers are automatically assigned to heart model after computation.

    plotter = pv.Plotter()
    mesh = model.mesh.ctp()
    streamlines = mesh.streamlines(vectors="fiber", source_radius=100, n_points=50000)
    tubes = streamlines.tube()
    plotter.add_mesh(mesh, opacity=0.5, color="white")
    plotter.add_mesh(tubes, color="red")
    plotter.show()


.. GENERATED FROM PYTHON SOURCE LINES 167-170

.. image:: /_static/images/atrial_fiber_assign.png
  :width: 400pt
  :align: center


.. _sphx_glr_download_examples_preprocessor_doc_example_atrial_fiber.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: doc_example_atrial_fiber.ipynb <doc_example_atrial_fiber.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: doc_example_atrial_fiber.py <doc_example_atrial_fiber.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: doc_example_atrial_fiber.zip <doc_example_atrial_fiber.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_

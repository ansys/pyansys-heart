
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/preprocessor/doc_preprocess_fullheart_rodero_01.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_preprocessor_doc_preprocess_fullheart_rodero_01.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_preprocessor_doc_preprocess_fullheart_rodero_01.py:


Create a full heart model
---------------------------------
This example shows you how to download a case from the Rodero et al (2021) database
and process that case into a simulation-ready four chamber heart model.

.. GENERATED FROM PYTHON SOURCE LINES 10-16

Example setup
-------------
Perform the required imports
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Import the required modules and set relevant paths, including that of the working
directory and generated model

.. GENERATED FROM PYTHON SOURCE LINES 16-37

.. code-block:: default



    import os
    from pathlib import Path

    from ansys.heart.misc.downloader import download_case, unpack_case
    import ansys.heart.preprocessor.models as models


    # specify necessary paths.
    # Note that we need to cast the paths to strings to facilitate serialization.
    case_file = str(
        Path(Path(__file__).resolve().parents[2], "downloads", "Cristobal2021", "01", "01.vtk")
    )
    download_folder = str(Path(Path(__file__).resolve().parents[2], "downloads"))
    workdir = str(
        Path(Path(__file__).resolve().parents[2], "downloads", "Cristobal2021", "01", "FullHeart2.0")
    )

    path_to_model = str(Path(workdir, "heart_model.pickle"))


.. GENERATED FROM PYTHON SOURCE LINES 44-48

Download the case
~~~~~~~~~~~~~~~~~
Download and unpack the case from the public repository of full hearts if it is
not yet available. This model will be used as input for the preprocessor.

.. GENERATED FROM PYTHON SOURCE LINES 48-54

.. code-block:: default

    if not os.path.isfile(case_file):
        path_to_downloaded_file = download_case(
            "Cristobal2021", 1, download_folder=download_folder, overwrite=False
        )
        unpack_case(path_to_downloaded_file)


.. GENERATED FROM PYTHON SOURCE LINES 55-59

Set required information
~~~~~~~~~~~~~~~~~~~~~~~~
Set the right database to which this case belongs, and set other relevant
information such as the desired mesh size.

.. GENERATED FROM PYTHON SOURCE LINES 59-74

.. code-block:: default

    info = models.ModelInfo(
        database="Cristobal2021",
        path_to_case=case_file,
        work_directory=workdir,
        path_to_model=path_to_model,
        mesh_size=2.0,
    )

    # create the working directory
    info.create_workdir()
    # clean the working directory
    info.clean_workdir(extensions_to_remove=[".stl", ".vtk", ".msh.h5"])
    # dump information to stdout
    info.dump_info()


.. GENERATED FROM PYTHON SOURCE LINES 75-82

Initialize the heart model
~~~~~~~~~~~~~~~~~~~~~~~~~~
Initialize the desired heart model, and invoke the main method to
extract the simulation mesh and dump the model to disk. This will extract
the relevant parts and features from the original model and remesh
the entire surface and volume. Relevant anatomical features that are extracted include
the endocardium, epicardium, apex, and valve annuli

.. GENERATED FROM PYTHON SOURCE LINES 82-101

.. code-block:: default


    # instantiate a four chamber model
    model = models.FullHeart(info)

    # extract the simulation mesh
    model.extract_simulation_mesh()

    # dump the model to disk for future use
    model.dump_model(path_to_model)

    # print information regarding the generated model
    model.print_info()

    # print part names
    print(model.part_names)
    # print volumes of some cavities:
    print(f"Volume of LV cavity: {model.left_ventricle.cavity.volume} mm^3")
    print(f"Volume of LV cavity: {model.left_atrium.cavity.volume} mm^3")


.. GENERATED FROM PYTHON SOURCE LINES 102-106

Visualize results
~~~~~~~~~~~~~~~~~
You can visualize and inspect the components of the model by accessing
various properties/attributes and invoke methods.

.. GENERATED FROM PYTHON SOURCE LINES 106-110

.. code-block:: default


    # plot the remeshed model
    model.plot_mesh(show_edges=False)


.. GENERATED FROM PYTHON SOURCE LINES 111-114

.. image:: /_static/images/full_heart_mesh.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 114-118

.. code-block:: default


    # plot the endocardial surface of the left ventricle.
    model.left_ventricle.endocardium.plot(show_edges=True, color="r")


.. GENERATED FROM PYTHON SOURCE LINES 119-122

.. image:: /_static/images/full_heart_lv_endocardium.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 122-131

.. code-block:: default


    # loop over all cavities and plot these in a single window.
    import pyvista as pv

    cavities = pv.PolyData()
    for c in model.cavities:
        cavities += c.surface
    cavities.plot(show_edges=True)


.. GENERATED FROM PYTHON SOURCE LINES 132-135

.. image:: /_static/images/full_heart_cavities.png
  :width: 400pt
  :align: center


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.000 seconds)


.. _sphx_glr_download_examples_preprocessor_doc_preprocess_fullheart_rodero_01.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: doc_preprocess_fullheart_rodero_01.py <doc_preprocess_fullheart_rodero_01.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: doc_preprocess_fullheart_rodero_01.ipynb <doc_preprocess_fullheart_rodero_01.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_

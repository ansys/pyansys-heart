refactor dyna writer to improve maintainability

.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/preprocessor/doc_preprocess_fourchamber.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_preprocessor_doc_preprocess_fourchamber.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_preprocessor_doc_preprocess_fourchamber.py:


Create a four chamber heart model
---------------------------------
This example shows you how to download a case from the Strocchi et al (2020) database
and process that case into a simulation-ready four chamber heart model.

.. GENERATED FROM PYTHON SOURCE LINES 10-16

Example setup
-------------
Perform the required imports
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Import the required modules and set relevant paths, including that of the working
directory and generated model

.. GENERATED FROM PYTHON SOURCE LINES 16-36

.. code-block:: default



    import os
    from pathlib import Path

    from ansys.heart.misc.downloader import download_case, unpack_case
    import ansys.heart.preprocessor.models as models


    # specify necessary paths.
    # Note that we need to cast the paths to strings to facilitate serialization.
    case_file = str(
        Path(Path(__file__).resolve().parents[2], "downloads", "Strocchi2020", "01", "01.case")
    )
    download_folder = str(Path(Path(__file__).resolve().parents[2], "downloads"))
    workdir = str(
        Path(Path(__file__).resolve().parents[2], "downloads", "Strocchi2020", "01", "FourChamber")
    )
    path_to_model = str(Path(workdir, "heart_model.pickle"))


.. GENERATED FROM PYTHON SOURCE LINES 43-47

Download the case
~~~~~~~~~~~~~~~~~
Download and unpack the case from the public repository of full hearts if it is
not yet available. This model will be used as input for the preprocessor.

.. GENERATED FROM PYTHON SOURCE LINES 47-53

.. code-block:: default

    if not os.path.isfile(case_file):
        path_to_downloaded_file = download_case(
            "Strocchi2020", 1, download_folder=download_folder, overwrite=False
        )
        unpack_case(path_to_downloaded_file)


.. GENERATED FROM PYTHON SOURCE LINES 54-58

Set required information
~~~~~~~~~~~~~~~~~~~~~~~~
Set the right database to which this case belongs, and set other relevant
information such as the desired mesh size.

.. GENERATED FROM PYTHON SOURCE LINES 58-75

.. code-block:: default

    info = models.ModelInfo(
        database="Strocchi2020",
        path_to_case=case_file,
        work_directory=workdir,
        path_to_model=path_to_model,
        add_blood_pool=False,
        mesh_size=1.5,
    )

    # create the working directory
    info.create_workdir()
    # clean the working directory
    info.clean_workdir(extensions_to_remove=[".stl", ".vtk", ".msh.h5"])
    # dump information to stdout
    info.dump_info()



.. GENERATED FROM PYTHON SOURCE LINES 76-82

Initialize the heart model
~~~~~~~~~~~~~~~~~~~~~~~~~~
Initialize the desired heart model, and invoke the main method to
extract the simulation mesh and dump the model to disk. This will extract
the relevant parts from the original model and remesh the entire surface and
volume. Moreover, relevant anatomical features are extracted.

.. GENERATED FROM PYTHON SOURCE LINES 82-100

.. code-block:: default


    # instantiate a four chamber model
    model = models.FourChamber(info)

    # extract the simulation mesh
    model.extract_simulation_mesh()

    # dump the model to disk for future use
    model.dump_model(path_to_model)
    # print the resulting information
    model.print_info()

    # print part names
    print(model.part_names)
    # print volumes of some cavities:
    print(f"Volume of LV cavity: {model.left_ventricle.cavity.volume} mm^3")
    print(f"Volume of LV cavity: {model.left_atrium.cavity.volume} mm^3")


.. GENERATED FROM PYTHON SOURCE LINES 101-105

Visualize results
~~~~~~~~~~~~~~~~~
You can visualize and inspect the components of the model by accessing
various properties/attributes and invoke methods.

.. GENERATED FROM PYTHON SOURCE LINES 105-109

.. code-block:: default


    # plot the remeshed model
    model.plot_mesh(show_edges=False)


.. GENERATED FROM PYTHON SOURCE LINES 110-113

.. image:: /_static/images/four_chamber_mesh.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 113-117

.. code-block:: default


    # plot the endocardial surface of the left ventricle.
    model.left_ventricle.endocardium.plot(show_edges=True, color="r")


.. GENERATED FROM PYTHON SOURCE LINES 118-121

.. image:: /_static/images/four_chamber_lv_endocardium.png
  :width: 400pt
  :align: center

.. GENERATED FROM PYTHON SOURCE LINES 121-130

.. code-block:: default


    # loop over all cavities and plot these in a single window.
    import pyvista as pv

    cavities = pv.PolyData()
    for c in model.cavities:
        cavities += c.surface
    cavities.plot(show_edges=True)


.. GENERATED FROM PYTHON SOURCE LINES 131-134

.. image:: /_static/images/four_chamber_cavities.png
  :width: 400pt
  :align: center


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.000 seconds)


.. _sphx_glr_download_examples_preprocessor_doc_preprocess_fourchamber.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: doc_preprocess_fourchamber.py <doc_preprocess_fourchamber.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: doc_preprocess_fourchamber.ipynb <doc_preprocess_fourchamber.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
